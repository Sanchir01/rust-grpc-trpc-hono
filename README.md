# Rust GRPC + tRPC + Hono Workspace Project ü¶Ä‚ö°Ô∏è

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π workspace-–ø—Ä–æ–µ–∫—Ç, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –Ω–∞ Rust —Å gRPC, –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∞–≥—Ä—É–∑–∫–∏, ingestion –≤ ClickHouse, tRPC API –Ω–∞ TypeScript + Hono, –∏ PostgreSQL –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω—É—é –ë–î.

## üì¶ –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **Rust** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫, –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã (`ingester`, `generator`)
- **ClickHouse** ‚Äî –≤—ã—Å–æ–∫–æ—Å–∫–æ—Ä–æ—Å—Ç–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –ë–î
- **PostgreSQL** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **gRPC** ‚Äî –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É `generator` –∏ `ingester`
- **Hono + tRPC** ‚Äî frontend/backend API –Ω–∞ TypeScript
- **Docker Compose** ‚Äî –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏
- **TOML-–∫–æ–Ω—Ñ–∏–≥–∏** ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **Drizzle ORM** ‚Äî ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
.
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ ts-api/         # TypeScript API –Ω–∞ Hono + tRPC
‚îÇ   ‚îú‚îÄ‚îÄ ingester/       # Rust-—Å–µ—Ä–≤–∏—Å –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse
‚îÇ   ‚îî‚îÄ‚îÄ generator/      # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Rust
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îî‚îÄ‚îÄ rust-deps/      # –û–±—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è Rust-—Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ       ‚îî‚îÄ‚îÄ proto/      # –ü—Ä–æ—Ç–æ–±—É—Ñ—ã –¥–ª—è gRPC
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ clickhouse/     # –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è ClickHouse
‚îÇ   ‚îî‚îÄ‚îÄ postgres/       # –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è PostgreSQL
‚îú‚îÄ‚îÄ docker-compose.yaml # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
‚îú‚îÄ‚îÄ Dockerfile          # –ú—É–ª—å—Ç–∏-—Å—Ç–µ–π–¥–∂ —Å–±–æ—Ä–∫–∞ Rust-—Å–µ—Ä–≤–∏—Å–æ–≤
‚îî‚îÄ‚îÄ Makefile            # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º
```

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- Rust (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- Node.js/Bun (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ TS-API)

### –ó–∞–ø—É—Å–∫ –≤ Docker

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
cp .env.example .env

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make compose
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ Ingester
make ingester

# –ó–∞–ø—É—Å–∫ Generator
make generator

# –ó–∞–ø—É—Å–∫ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make workspace

# –ó–∞–ø—É—Å–∫ TS-API
cd apps/ts-api
bun run dev
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:

```
CLICKHOUSE_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å
POSTGRES_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å
```

### –°—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö

- **PostgreSQL**: `postgresql://postgres:password@postgres:5432/postgres`
- **ClickHouse**: `http://clickhouse:8123` –∏–ª–∏ `tcp://clickhouse:9000`

## üóÑÔ∏è –ú–∏–≥—Ä–∞—Ü–∏–∏

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Goose –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```bash
# –ú–∏–≥—Ä–∞—Ü–∏–∏ PostgreSQL
make migrations-up-pg

# –ú–∏–≥—Ä–∞—Ü–∏–∏ ClickHouse
make migrations-new-ch MIGRATION_NAME=–∏–º—è_–º–∏–≥—Ä–∞—Ü–∏–∏
```

## üìù API

TS-API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏:

- `GET /posts` - –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤
- `POST /posts` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç
- `DELETE /posts/:id` - —É–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç

## üîç –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞

- –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Rust
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å ClickHouse
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API —Å tRPC –∏ Hono
- –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º tokio

## üì° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ gRPC API —Å –ø–æ–º–æ—â—å—é grpcui

–î–ª—è —É–¥–æ–±–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è gRPC API –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å grpcui - –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å gRPC-—Å–µ—Ä–≤–∏—Å–∞–º–∏:

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ grpcui

```bash
go install github.com/fullstorydev/grpcui/cmd/grpcui@latest
```

### –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
grpcui -plaintext localhost:50051

# –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Docker
grpcui -plaintext -bind=0.0.0.0 -port=8080 ingester:50051
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:50051 (–∏–ª–∏ –¥—Ä—É–≥–æ–º—É —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ø–æ—Ä—Ç—É), —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è gRPC –º–µ—Ç–æ–¥–æ–≤.

```

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–í–∫–ª–∞–¥—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è! –î–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è —Ñ–∏—á–∏ (`git checkout -b feature/amazing-feature`)
3. –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git commit -m 'Add some amazing feature'`)
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤–µ—Ç–∫—É (`git push origin feature/amazing-feature`)
5. –û—Ç–∫—Ä–æ–π—Ç–µ Pull Request
```
